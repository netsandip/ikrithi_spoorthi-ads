<?phpclass Tax extends MY_Controller {    function __construct() {        parent::__construct();        $this->load->helper(array('form'));        $this->load->library(array('form_validation'));        $this->load->model('tax_model');    }    public function index() {        $this->data['subview'] = $this->load->view('tax/view', NULL, TRUE);        $this->load->view('layout/header');        $this->load->view('layout/_main', $this->data);        $this->load->view('layout/footer');    }    public function quick_add() {        $data['input_name'] = array('type' => 'text', 'id' => 'name', 'name' => 'name');        $this->load->view('tax/_modal_add', $data);    }    public function add() {        $this->data['action'] = 'tax/add';        /*         * Validation rules         */        $rules_add_tax = array(            array(                'field' => 'name',                'label' => 'Name',                'rules' => 'required|trim'            ),            array(                'field' => 'type',                'label' => 'Type',                'rules' => 'required'            ),            array(                'field' => 'value',                'label' => 'Value',                'rules' => 'required|numeric|trim'            ),        );        $this->form_validation->set_rules($rules_add_tax);        if ($this->form_validation->run() === FALSE) {            $this->data['message'] = (validation_errors() == '') ? $this->session->flashdata('message') : alert_message(validation_errors(), 'error');        } else {            $this->tax_model->create();            $this->session->set_flashdata('message', alert_message('Tax added successfully', 'success'));            redirect('tax/add', 'refresh');        }        /*         * Form inputs         */        $this->data['input_name'] = array('type' => 'text', 'id' => 'name', 'name' => 'name', 'value' => set_value('name'));        $this->data['input_value'] = array('type' => 'text', 'id' => 'value', 'name' => 'value', 'value' => set_value('value'));        $this->data['dropdown_type']['options'][''] = 'Select Type';        $this->data['dropdown_type']['options']['percentage'] = 'Percentage';        $this->data['dropdown_type']['options']['fixed'] = 'Fixed Amount';        $this->data['dropdown_type']['default'] = set_value('type');        $this->data['subview'] = $this->load->view('tax/add', $this->data, TRUE);        $this->load->view('layout/header');        $this->load->view('layout/_main', $this->data);        $this->load->view('layout/footer');    }    public function edit($id) {        $this->data['action'] = 'tax/edit/' . $id;        $row = $this->tax_model->find_by_id($id);        /*         * Validation rules         */        $rules_add_tax = array(            array(                'field' => 'name',                'label' => 'Name',                'rules' => 'required|trim'            ),            array(                'field' => 'type',                'label' => 'Type',                'rules' => 'required'            ),            array(                'field' => 'value',                'label' => 'Value',                'rules' => 'required|numeric|trim'            ),        );        $this->form_validation->set_rules($rules_add_tax);        if ($this->form_validation->run() === FALSE) {            $this->data['message'] = (validation_errors() == '') ? $this->session->flashdata('message') : alert_message(validation_errors(), 'error');        } else {            $this->tax_model->update($id);            $this->session->set_flashdata('message', alert_message('Tax updated successfully', 'success'));            redirect('tax/edit/' . $id, 'refresh');        }        /*         * Form inputs         */        $this->data['input_name'] = array('type' => 'text', 'id' => 'name', 'name' => 'name', 'value' => $row->name);        $this->data['input_value'] = array('type' => 'text', 'id' => 'value', 'name' => 'value', 'value' => $row->value);        $this->data['dropdown_type']['options'][''] = 'Select Type';        $this->data['dropdown_type']['options']['percentage'] = 'Percentage';        $this->data['dropdown_type']['options']['fixed'] = 'Fixed Amount';        $this->data['dropdown_type']['default'] = $row->type;        $this->data['subview'] = $this->load->view('tax/add', $this->data, TRUE);        $this->load->view('layout/header');        $this->load->view('layout/_main', $this->data);        $this->load->view('layout/footer');    }    public function fetch_post() {        $draw = $this->input->post('draw');        $limit = $this->input->post('length');        $offset = $this->input->post('start');        $search = $this->input->post('search[value]');        $sort_column = $this->input->post('order[0][column]');        $order = $this->input->post('order[0][dir]');        $data = array(            'limit' => $limit,            'offset' => $offset,            'search' => $search,            'sort' => $sort_column,            'order' => $order        );        $total_records = $this->tax_model->total_records();        $return_data = $this->tax_model->get_view($data);        if ($return_data['query']) {            foreach ($return_data['query']->result() as $row) {                $rows[] = array(                    form_checkbox('chk_row[]', $row->id, FALSE, array('class' => 'chk_row')),                    html_escape($row->name),                    html_escape(ucfirst($row->type)),                    html_escape($row->value),                    "<a href='" . base_url('tax/edit/' . html_escape($row->id)) . "' class='btn btn-xs btn-success'><i class='fa fa-edit'></i></a>"                );            }            $filtered_records = $return_data['count'];        } else {            $filtered_records = 0;            $rows = '';        }        $output = array(            'draw' => (int) $draw,            'recordsFiltered' => $filtered_records,            'recordsTotal' => $total_records,            'data' => $rows        );        $this->output                ->set_content_type('application/json')                ->set_output(json_encode($output));    }    public function bulk_delete() {        $ids = $this->input->post('data_ids');        if (empty($ids)) {            $this->session->set_flashdata('message', alert_message('Selected atleast one record to delete', 'success'));            redirect('tax', 'refresh');        }        $id_array = explode(",", $ids);        foreach ($id_array AS $id) {            $this->tax_model->delete($id);        }        $this->session->set_flashdata('message', alert_message('Selected records are deleted', 'success'));        redirect('tax', 'refresh');    }}